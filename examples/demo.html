<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CkEditableArray Component Demo</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen,
          Ubuntu, Cantarell, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        padding: 2rem;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      h1 {
        text-align: center;
        color: #333;
        margin-bottom: 1rem;
        font-size: 2.5rem;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 3rem;
        font-size: 1.1rem;
      }

      .demo-section {
        background: white;
        border-radius: 8px;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .demo-section h2 {
        color: #333;
        margin-bottom: 1.5rem;
        font-size: 1.5rem;
        border-bottom: 2px solid #667eea;
        padding-bottom: 0.5rem;
      }

      .demo-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 2rem;
      }

      .demo-item {
        background: #f9f9f9;
        border: 1px solid #eee;
        border-radius: 4px;
        padding: 1.5rem;
      }

      .demo-item h3 {
        color: #667eea;
        margin-bottom: 1rem;
        font-size: 1.1rem;
      }

      .component-wrapper {
        margin-bottom: 1.5rem;
      }

      .datachange-controls {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 0.75rem;
        margin: 0 0 1rem;
      }

      .datachange-controls label {
        display: grid;
        gap: 0.25rem;
        font-size: 0.9rem;
        color: #333;
      }

      .datachange-controls select,
      .datachange-controls input {
        padding: 0.5rem;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 0.95rem;
      }

      ck-editable-array {
        --cea-message-color: #333;
      }

      .code-block {
        background: #f4f4f4;
        border-left: 4px solid #667eea;
        padding: 1rem;
        margin: 1rem 0;
        border-radius: 4px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        line-height: 1.4;
      }

      .output {
        background: #f0f0f0;
        border-radius: 4px;
        padding: 1rem;
        margin: 1rem 0;
        font-family: 'Courier New', monospace;
        font-size: 0.9rem;
        max-height: 200px;
        overflow-y: auto;
        white-space: pre-wrap;
        word-wrap: break-word;
      }

      button {
        background: #667eea;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
        margin: 0.5rem 0;
        transition: background 0.2s;
      }

      button:hover {
        background: #5568d3;
      }

      button:active {
        transform: scale(0.98);
      }

      .section-description {
        color: #666;
        margin-bottom: 1.5rem;
        line-height: 1.6;
      }

      .feature-list {
        list-style: none;
        margin: 1rem 0;
      }

      .feature-list li {
        padding: 0.5rem 0;
        color: #666;
      }

      .feature-list li:before {
        content: '‚úì ';
        color: #667eea;
        font-weight: bold;
        margin-right: 0.5rem;
      }

      .mutation-demo {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin: 1rem 0;
      }

      @media (max-width: 768px) {
        .mutation-demo {
          grid-template-columns: 1fr;
        }

        h1 {
          font-size: 1.8rem;
        }

        .demo-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéâ CkEditableArray Component Demo</h1>
      <p class="subtitle">Explore the power of web components with automatic data cloning</p>

      <!-- Basic Usage Demo -->
      <div class="demo-section">
        <h2>1. Basic Usage</h2>
        <p class="section-description">
          The CkEditableArray component renders a greeting with a customizable name.
        </p>

        <div class="demo-grid">
          <!-- Default Component -->
          <div class="demo-item">
            <h3>Default (No Attributes)</h3>
            <div class="component-wrapper">
              <ck-editable-array id="demo1"></ck-editable-array>
            </div>
            <div class="code-block">
&lt;ck-editable-array&gt;&lt;/ck-editable-array&gt;
            </div>
          </div>

          <!-- With Name -->
          <div class="demo-item">
            <h3>With Custom Name</h3>
            <div class="component-wrapper">
              <ck-editable-array id="demo2" name="Developer"></ck-editable-array>
            </div>
            <div class="code-block">
&lt;ck-editable-array name="Developer"&gt;&lt;/ck-editable-array&gt;
            </div>
          </div>

        </div>
      </div>

      <!-- Data Property Demo -->
      <div class="demo-section">
        <h2>2. Data Property Management</h2>
        <p class="section-description">
          The component manages data arrays with automatic normalization and deep cloning.
        </p>

        <div class="demo-item">
          <h3>Setting and Getting Data</h3>

          <p style="margin: 1rem 0; color: #666;">
            <strong>Status:</strong> <span id="dataStatus">No data set yet</span>
          </p>

          <button onclick="setBasicData()">Set Basic Array Data</button>
          <button onclick="setComplexData()">Set Complex Nested Data</button>
          <button onclick="displayData()">Display Current Data</button>
          <button onclick="clearData()">Clear Data</button>

          <div class="output" id="output">Output will appear here...</div>
          <div class="output" id="eventOutput">Event log will appear here...</div>

          <div class="code-block">
// Set data
const element = document.querySelector('ck-editable-array');
element.addEventListener('rowchanged', (e) => console.log(e.detail.index, e.detail.row));
element.addEventListener('datachanged', (e) => console.log(e.detail.data));
element.data = [
  { id: 1, name: 'Item 1' },
  { id: 2, name: 'Item 2' }
];

// Get data (returns a deep clone)
const currentData = element.data;
console.log(currentData);
          </div>
        </div>
      </div>

      <!-- Normalization Demo -->
      <div class="demo-section">
        <h2>3. Data Normalization</h2>
        <p class="section-description">
          Non-array values are automatically normalized to empty arrays.
        </p>

        <div class="demo-item">
          <h3>Try Setting Non-Array Values</h3>

          <button onclick="normalizeNull()">Set data = null</button>
          <button onclick="normalizeUndefined()">Set data = undefined</button>
          <button onclick="normalizeString()">Set data = "string"</button>
          <button onclick="normalizeNumber()">Set data = 123</button>
          <button onclick="normalizeObject()">Set data = {}</button>

          <div class="output" id="normalizeOutput">
All non-arrays will be normalized to []
          </div>

          <div class="code-block">
// Any non-array normalizes to []
element.data = null;         // ‚Üí []
element.data = undefined;    // ‚Üí []
element.data = "string";     // ‚Üí []
element.data = 123;          // ‚Üí []
element.data = {};           // ‚Üí []
          </div>
        </div>
      </div>

      <!-- Deep Cloning Demo -->
      <div class="demo-section">
        <h2>4. Deep Cloning & Immutability</h2>
        <p class="section-description">
          All data is automatically deep cloned on get and set, preventing mutations from affecting the
          component's internal state.
        </p>

        <div class="demo-item">
          <h3>Mutation Protection on Set</h3>

          <p style="margin: 1rem 0; color: #666;">
            <strong>Scenario:</strong> We set data, then modify the original array/objects in consumer code.
            The component's internal state should remain unchanged.
          </p>

          <button onclick="testSetCloning()">Test Set Cloning</button>

          <div class="output" id="setCloningOutput">
Click the button to test...
          </div>

          <div class="code-block">
const original = [{ id: 1, name: 'Original' }];
element.data = original;

// Modify the original (shouldn't affect component)
original[0].name = 'Modified';

console.log(element.data[0].name); // Still 'Original' ‚úì
          </div>
        </div>

        <div class="demo-item">
          <h3>Mutation Protection on Get</h3>

          <p style="margin: 1rem 0; color: #666;">
            <strong>Scenario:</strong> We get data and modify it in consumer code. The component's internal
            state should remain unchanged.
          </p>

          <button onclick="testGetCloning()">Test Get Cloning</button>

          <div class="output" id="getCloningOutput">
Click the button to test...
          </div>

          <div class="code-block">
// Get data and modify it
const retrieved = element.data;
retrieved[0].name = 'Modified';

// Component data is unchanged
console.log(element.data[0].name); // Still 'Original' ‚úì
          </div>
        </div>
      </div>

      <!-- API Reference -->
      <div class="demo-section">
        <h2>5. API Reference</h2>

        <div class="demo-item">
          <h3>Properties</h3>
          <ul class="feature-list">
            <li><code>data: unknown[]</code> - Getter/setter for data array (with deep cloning)</li>
            <li><code>name: string</code> - Greeting name (default: "World")</li>
          </ul>

          <h3 style="margin-top: 1.5rem;">Attributes</h3>
          <ul class="feature-list">
            <li><code>name</code> - Synced with name property</li>
            <li><code>root-class</code>, <code>rows-class</code>, <code>row-class</code> - Optional wrapper classes</li>
          </ul>

          <h3 style="margin-top: 1.5rem;">Features</h3>
          <ul class="feature-list">
            <li>Automatic data normalization (non-arrays ‚Üí [])</li>
            <li>Deep cloning on get and set (immutability)</li>
            <li>structuredClone() primary strategy with JSON fallback</li>
            <li>Light DOM display templates via <code>&lt;template slot="display"&gt;</code></li>
            <li>Shadow DOM encapsulation</li>
            <li>Constructable Stylesheets with fallback</li>
            <li>TypeScript support</li>
          </ul>
        </div>
      </div>

      <!-- Usage Tips -->
      <div class="demo-section">
        <h2>6. Usage Tips</h2>

        <div class="demo-item">
          <h3>üéØ Best Practices</h3>
          <ul class="feature-list">
            <li>Always assign to <code>element.data</code>, not attributes</li>
            <li>Remember that <code>get data()</code> returns a clone, not a reference</li>
            <li>To update data, get it, modify, then set it back</li>
            <li>Use with any serializable/cloneable objects</li>
            <li>Component works with deeply nested data structures</li>
          </ul>

          <h3 style="margin-top: 1.5rem;">‚ö†Ô∏è Common Pitfalls</h3>
          <ul style="list-style: none; margin: 1rem 0;">
            <li style="padding: 0.5rem 0; color: #d32f2f;">
              ‚úó <code>element.setAttribute('data', JSON.stringify(arr))</code> - Won't work
            </li>
            <li style="padding: 0.5rem 0; color: #388e3c;">
              ‚úì <code>element.data = arr</code> - Correct
            </li>
          </ul>

          <h3 style="margin-top: 1.5rem;">üìä Performance Notes</h3>
          <ul class="feature-list">
            <li>Deep cloning is O(n) where n = data size</li>
            <li>Small datasets (< 1000 items): negligible overhead</li>
            <li>Large datasets: batch updates to minimize cloning calls</li>
            <li>Constructable Stylesheets: optimal performance across instances</li>
          </ul>
        </div>
      </div>

      <!-- Display Template -->
      <div class="demo-section">
        <h2>7. Display Template (Light DOM)</h2>
        <p class="section-description">
          Provide a <code>&lt;template slot="display"&gt;</code> inside the element as a <strong>row template</strong>.
          The template is cloned once per <code>element.data</code> item, and elements with <code>data-bind</code> get
          their text filled from each row object.
        </p>

        <div class="demo-grid">
          <div class="demo-item">
            <h3>With Display Template</h3>
            <div class="component-wrapper">
              <ck-editable-array id="templateDemo" name="Templated">
                <template slot="display">
                  <style>
                    .display-content {
                      padding: 0.75rem;
                      background: #f9f9f9;
                      border-radius: 4px;
                      transition: all 0.3s ease;
                      border-left: 4px solid transparent;
                    }
                    .row.ck-in-edit .display-content {
                      display: none;
                    }
                    .edit-content {
                      padding: 0.75rem;
                      background: #fff3cd;
                      border: 2px solid #ffc107;
                      border-radius: 4px;
                      display: none;
                    }
                    .row.ck-in-edit .edit-content {
                      display: block;
                    }
                    .edit-content label {
                      display: grid;
                      gap: 0.25rem;
                      font-size: 0.9rem;
                      font-weight: 500;
                      margin-bottom: 0.5rem;
                    }
                    .edit-content input {
                      padding: 0.5rem;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                      font-size: 0.95rem;
                    }
                  </style>
                  <div class="display-content">
                    <strong data-bind="name"></strong>
                    <div style="margin-top: 0.25rem;">
                      <span data-bind="address.city"></span>
                    </div>
                    <div style="margin-top: 0.25rem; opacity: 0.9;">
                      <small data-bind="tags"></small>
                    </div>
                  </div>
                </template>
                <template slot="edit">
                  <div class="edit-content">
                    <label>
                      Name
                      <input type="text" data-bind="name" placeholder="Enter name" />
                    </label>
                    <label>
                      City
                      <input type="text" data-bind="address.city" placeholder="Enter city" />
                    </label>
                    <p style="font-size: 0.85rem; color: #666; margin: 0;">
                      ‚ö†Ô∏è Editing mode - row highlighted in yellow
                    </p>
                  </div>
                </template>
              </ck-editable-array>
            </div>
            <div class="code-block">
&lt;ck-editable-array&gt;
  &lt;template slot="display"&gt;
    &lt;!-- Content shown in display mode --&gt;
    &lt;strong data-bind="name"&gt;&lt;/strong&gt;
  &lt;/template&gt;
  &lt;template slot="edit"&gt;
    &lt;!-- Content shown in edit mode --&gt;
    &lt;input type="text" data-bind="name" /&gt;
  &lt;/template&gt;
&lt;/ck-editable-array&gt;

/* CSS for visual distinction */
.row.ck-in-edit { /* automatically applied when row is in edit mode */
  border-color: #ffc107;
}
            </div>
          </div>

          <div class="demo-item">
            <h3>Empty State (No Template)</h3>
            <div class="component-wrapper">
              <ck-editable-array id="emptyStateDemo" name="Empty State"></ck-editable-array>
            </div>
            <p class="section-description" style="margin-top: 1rem;">
              When no display template is present, the component shows a helpful message in its rows region.
            </p>
          </div>
        </div>
      </div>

      <!-- Wrapper Class Hooks -->
      <div class="demo-section">
        <h2>8. Wrapper Class Hooks (Display Phase)</h2>
        <p class="section-description">
          Set <code>root-class</code>, <code>rows-class</code>, and <code>row-class</code> to add extra classes to the
          generated wrappers (root, rows host, and each row wrapper). Because those wrappers are inside Shadow DOM, this
          demo styles them using a <code>&lt;style&gt;</code> inside the display template.
        </p>

        <div class="demo-grid">
          <div class="demo-item">
            <h3>Custom Wrapper Classes</h3>
            <div class="component-wrapper">
              <ck-editable-array
                id="wrapperClassDemo"
                name="Wrapper Classes"
                root-class="demo-root"
                rows-class="demo-rows"
                row-class="demo-row"
              >
                <template slot="display">
                  <style>
                    .ck-editable-array.demo-root {
                      background: #f6f8ff;
                      padding: 0.75rem;
                      border-radius: 12px;
                    }

                    .rows.demo-rows {
                      display: grid;
                      gap: 0.5rem;
                    }

                    .row.demo-row {
                      background: #fff;
                      border: 1px solid #dde3ff;
                      border-radius: 10px;
                      padding: 0.75rem;
                      transition: all 0.3s ease;
                    }

                    .row.demo-row.ck-in-edit {
                      background: #f0e6ff;
                      border: 2px solid #667eea;
                      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
                    }

                    .display-item {
                      display: block;
                    }

                    .row.demo-row.ck-in-edit .display-item {
                      display: none;
                    }

                    .edit-item {
                      display: none;
                    }

                    .row.demo-row.ck-in-edit .edit-item {
                      display: block;
                    }

                    .edit-item label {
                      display: grid;
                      gap: 0.25rem;
                      font-size: 0.9rem;
                      font-weight: 500;
                      margin-bottom: 0.5rem;
                    }

                    .edit-item input {
                      padding: 0.5rem;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                    }
                  </style>
                  <div class="display-item">
                    <strong data-bind="title"></strong>
                    <span style="margin-left: 0.5rem; opacity: 0.8" data-bind="status"></span>
                  </div>
                </template>
                <template slot="edit">
                  <div class="edit-item">
                    <label>
                      Title
                      <input type="text" data-bind="title" placeholder="Enter title" />
                    </label>
                    <label>
                      Status
                      <input type="text" data-bind="status" placeholder="Enter status" />
                    </label>
                    <p style="font-size: 0.85rem; color: #667eea; margin: 0;">
                      ‚úèÔ∏è Editing - wrapper class demo with blue highlight
                    </p>
                  </div>
                </template>
              </ck-editable-array>
            </div>
          </div>
        </div>
      </div>

      <!-- Row Actions Demo -->
      <div class="demo-section">
        <h2>9. Row Actions (Edit, Save, Cancel, Delete)</h2>
        <p class="section-description">
          Each row provides action buttons for managing that row. The <strong>delete button</strong> implements soft delete by toggling an `isDeleted` property, and the button changes to "Restore" when a row is deleted.
        </p>

        <div class="demo-item">
          <h3>Row Action Buttons</h3>
          <p style="color: #666; margin-bottom: 1rem;">
            Each row includes the following action buttons (all with accessible aria-labels):
          </p>
          <ul class="feature-list">
            <li><strong>Edit</strong> - Toggles the row into edit mode (disabled when row is deleted)</li>
            <li><strong>Save</strong> (edit mode only) - Commits changes and returns to display mode</li>
            <li><strong>Cancel</strong> (edit mode only) - Discards changes and returns to display mode</li>
            <li><strong>Delete</strong> - Sets `isDeleted` property to true; changes to "Restore" when deleted</li>
            <li><strong>Restore</strong> - Clears `isDeleted` property; changes back to "Delete" when restored; re-enables Edit button</li>
          </ul>
          <p style="color: #666; margin-top: 1rem;">
            All buttons have context-aware aria-labels like "Edit item 1", "Delete item 2", "Restore item 3", etc., for better accessibility. The Edit button is automatically disabled when a row is marked as deleted to prevent accidental edits.
          </p>

          <h4 style="margin-top: 1.5rem; color: #667eea;">Soft Delete Example</h4>
          <p style="color: #666; margin: 0.5rem 0;">
            Click the delete button on any row to set its `isDeleted` property to true. The button will change to "Restore", the row will be styled with the `ck-deleted` class, and the Edit button will become disabled. Click the Restore button to reverse these changes.
          </p>
          <div class="component-wrapper" style="margin-top: 1rem;">
            <ck-editable-array id="softDeleteDemo" name="tasks">
              <template slot="display">
                <style>
                  .task-row {
                    padding: 0.75rem;
                    background: #f9f9f9;
                    border-radius: 4px;
                    transition: all 0.3s ease;
                  }
                  .row.ck-deleted .task-row {
                    opacity: 0.6;
                    text-decoration: line-through;
                    background: #f0f0f0;
                    border-left: 4px solid #999;
                  }
                  .row.ck-deleted .task-row strong {
                    color: #999;
                  }
                </style>
                <div class="task-row">
                  <strong data-bind="title"></strong>
                  <span style="margin-left: 0.5rem; font-size: 0.9rem; color: #999;">
                    Status: <span data-bind="isDeleted"></span>
                  </span>
                </div>
              </template>

              <template slot="edit">
                <style>
                  .task-edit {
                    padding: 0.75rem;
                    background: #f9f9f9;
                    border-radius: 4px;
                    display: grid;
                    gap: 0.5rem;
                  }
                  .row.ck-deleted .task-edit {
                    opacity: 0.6;
                    background: #f0f0f0;
                    border-left: 4px solid #999;
                  }
                  .task-edit label {
                    display: grid;
                    gap: 0.25rem;
                    font-size: 0.9rem;
                    font-weight: 500;
                    color: #333;
                  }
                  .row.ck-deleted .task-edit label {
                    color: #666;
                  }
                  .task-edit input {
                    padding: 0.5rem;
                    border: 1px solid #ddd;
                    border-radius: 4px;
                    font-size: 0.95rem;
                  }
                  .row.ck-deleted .task-edit input {
                    background-color: #e8e8e8;
                    color: #999;
                  }
                </style>
                <div class="task-edit">
                  <label>
                    Task Title
                    <input type="text" data-bind="title" placeholder="Enter task title" />
                  </label>
                </div>
              </template>
            </ck-editable-array>
          </div>
          <div class="code-block">
// CSS styles for deleted state
.row.ck-deleted .task-row {
  opacity: 0.6;
  text-decoration: line-through;
  background: #f0f0f0;
  border-left: 4px solid #999;
}

.row.ck-deleted .task-edit {
  opacity: 0.6;
  background: #f0f0f0;
  border-left: 4px solid #999;
}

// User experience:
// Click delete -> row gets ck-deleted class
// Display content: grayed out, strikethrough
// Edit content: disabled appearance
// Click restore -> class removed, everything returns to normal
          </div>
        </div>
      </div>

      <!-- Edit Template Demo -->
      <div class="demo-section">
        <h2>10. Edit Template with Auto-Populated Inputs</h2>
        <p class="section-description">
          Form inputs in edit templates automatically have their values populated from row data.
          Text inputs get their <code>value</code>, checkboxes get <code>checked</code>, and selects have the matching option selected.
        </p>

        <div class="demo-grid">
          <div class="demo-item">
            <h3>Automatic Input Value Binding</h3>
            <div class="component-wrapper">
              <ck-editable-array id="editBindingDemo" name="Edit Binding">
                <template slot="display">
                  <style>
                    .display-row {
                      padding: 0.5rem;
                      background: #f9f9f9;
                      border-radius: 8px;
                      border-left: 4px solid transparent;
                      transition: all 0.3s ease;
                    }
                    .row.ck-in-edit .display-row {
                      display: none;
                    }
                    .edit-row {
                      padding: 0.75rem;
                      background: #fff;
                      border: 2px solid #667eea;
                      border-radius: 8px;
                      display: none;
                      grid-template-columns: repeat(3, 1fr);
                      gap: 0.5rem;
                    }
                    .row.ck-in-edit .edit-row {
                      display: grid;
                    }
                    .edit-row label {
                      display: grid;
                      gap: 0.25rem;
                      font-size: 0.9rem;
                      font-weight: 500;
                    }
                    .edit-row input,
                    .edit-row select {
                      padding: 0.5rem;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                      font-size: 0.95rem;
                    }
                    .edit-row input:focus,
                    .edit-row select:focus {
                      outline: none;
                      border-color: #667eea;
                      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                  </style>
                  <div class="display-row">
                    <strong data-bind="name"></strong> -
                    <span data-bind="role"></span>
                    (<span data-bind="status"></span>)
                  </div>
                </template>

                <template slot="edit">
                  <div class="edit-row">
                    <label>
                      Name
                      <input type="text" data-bind="name" />
                    </label>
                    <label>
                      Role
                      <select data-bind="role">
                        <option value="Developer">Developer</option>
                        <option value="Designer">Designer</option>
                        <option value="Manager">Manager</option>
                      </select>
                    </label>
                    <label>
                      Status
                      <select data-bind="status">
                        <option value="Active">Active</option>
                        <option value="Inactive">Inactive</option>
                      </select>
                    </label>
                  </div>
                </template>
              </ck-editable-array>
            </div>
            <p class="section-description" style="margin-top: 1rem;">
              <strong>Note:</strong> Open browser DevTools and inspect the inputs in the Shadow DOM.
              You'll see they're automatically populated with values from the data!
            </p>
            <div class="code-block">
&lt;template slot="edit"&gt;
  &lt;!-- Inputs auto-populate from data --&gt;
  &lt;input type="text" data-bind="name" /&gt;
  &lt;select data-bind="role"&gt;
    &lt;option value="Developer"&gt;Developer&lt;/option&gt;
    &lt;option value="Designer"&gt;Designer&lt;/option&gt;
  &lt;/select&gt;
&lt;/template&gt;
            </div>
          </div>
        </div>
      </div>

      <!-- Bidirectional Binding Demo -->
      <div class="demo-section">
        <h2>11. Bidirectional Data Binding (Live Sync)</h2>
        <p class="section-description">
          When users type in edit template inputs, changes automatically sync to both the component's data AND the corresponding display elements in real-time. No manual event handling required!
        </p>

        <div class="demo-grid">
          <div class="demo-item">
            <h3>Live Edit-to-Display Sync</h3>
            <div class="component-wrapper">
              <ck-editable-array id="liveBindingDemo" name="contacts">
                <template slot="display">
                  <style>
                    .display-card {
                      padding: 0.75rem;
                      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                      color: white;
                      border-radius: 8px;
                      margin-bottom: 0.5rem;
                      transition: all 0.3s ease;
                    }
                    .row.ck-in-edit .display-card {
                      display: none;
                    }
                    .display-card .name {
                      font-size: 1.1rem;
                      font-weight: bold;
                      margin-bottom: 0.25rem;
                    }
                    .display-card .email {
                      opacity: 0.9;
                      font-size: 0.9rem;
                    }
                    .display-card .status {
                      margin-top: 0.5rem;
                      padding: 0.25rem 0.5rem;
                      background: rgba(255, 255, 255, 0.2);
                      border-radius: 4px;
                      display: inline-block;
                      font-size: 0.85rem;
                    }
                    .edit-card {
                      padding: 0.75rem;
                      background: #f9f9f9;
                      border: 2px dashed #667eea;
                      border-radius: 8px;
                      margin-top: 0.5rem;
                      display: none;
                      gap: 0.5rem;
                    }
                    .row.ck-in-edit .edit-card {
                      display: grid;
                    }
                    .edit-card label {
                      display: grid;
                      gap: 0.25rem;
                      font-size: 0.9rem;
                      font-weight: 500;
                      color: #333;
                    }
                    .edit-card input,
                    .edit-card select {
                      padding: 0.5rem;
                      border: 1px solid #ddd;
                      border-radius: 4px;
                      font-size: 0.95rem;
                    }
                    .edit-card input:focus,
                    .edit-card select:focus {
                      outline: none;
                      border-color: #667eea;
                      box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
                    }
                    .edit-indicator {
                      font-size: 0.85rem;
                      color: #667eea;
                      font-weight: 500;
                      margin-top: 0.5rem;
                      padding-top: 0.5rem;
                      border-top: 1px solid #ddd;
                    }
                  </style>
                  <div class="display-card">
                    <div class="name" data-bind="name"></div>
                    <div class="email" data-bind="email"></div>
                    <div class="status" data-bind="status"></div>
                  </div>
                </template>

                <template slot="edit">
                  <div class="edit-card">
                    <label>
                      Name (type to see instant update above)
                      <input type="text" data-bind="name" placeholder="Enter name" />
                    </label>
                    <label>
                      Email
                      <input type="email" data-bind="email" placeholder="Enter email" />
                    </label>
                    <label>
                      Status
                      <select data-bind="status">
                        <option value="Active">Active</option>
                        <option value="Away">Away</option>
                        <option value="Offline">Offline</option>
                      </select>
                    </label>
                    <div class="edit-indicator">
                      ‚úèÔ∏è Editing mode - Display card hidden above
                    </div>
                  </div>
                </template>
              </ck-editable-array>
            </div>
            <div class="datachange-controls">
              <label>
                datachange-mode
                <select id="liveBindingMode">
                  <option value="debounced" selected>debounced</option>
                  <option value="change">change</option>
                  <option value="save">save</option>
                </select>
              </label>
              <label>
                debounce (ms)
                <input id="liveBindingDebounce" type="number" min="0" value="300" />
              </label>
            </div>
            <p class="section-description" style="margin-top: 1rem;">
              <strong>Try it:</strong> Start typing in any input field above and watch the display card update instantly. Row updates emit <code>rowchanged</code>; full <code>datachanged</code> follows the mode you select.
            </p>
            <div class="code-block">
// No code needed - it just works!
// When user types -> data updates -> display updates
// rowchanged fires on each edit
// datachanged fires based on datachange-mode (debounced by default)
            </div>
          </div>
        </div>

        <div class="demo-item">
          <h3>Data Event Log</h3>
          <p class="section-description">
            This log shows <code>rowchanged</code> events on each edit and debounced
            <code>datachanged</code> events based on the selected mode.
          </p>
          <div class="output" id="bindingEventLog" style="max-height: 150px;">
Waiting for input changes...
          </div>
        </div>
      </div>
    </div>

    <!-- Component Import -->
    <script type="module">
      // Use a relative import so the demo works when served directly (no bundler/import-map).
      import '../dist/ck-editable-array/ck-editable-array.esm.js';

      // Display template demo initialization
      const templateDemo = document.getElementById('templateDemo');
      if (templateDemo) {
        templateDemo.data = [
          { name: 'Ada', address: { city: 'Dublin' }, tags: ['web', 'wc'] },
          { name: 'Linus', address: { city: 'Helsinki' }, tags: ['oss'] },
        ];
      }

      const emptyStateDemo = document.getElementById('emptyStateDemo');
      if (emptyStateDemo) {
        emptyStateDemo.data = [{ name: 'This will not render without a template' }];
      }

      const wrapperClassDemo = document.getElementById('wrapperClassDemo');
      if (wrapperClassDemo) {
        wrapperClassDemo.data = [
          { title: 'Alpha', status: 'ready' },
          { title: 'Beta', status: 'in progress' },
          { title: 'Gamma', status: 'done' },
        ];
      }

      const editBindingDemo = document.getElementById('editBindingDemo');
      if (editBindingDemo) {
        editBindingDemo.data = [
          { name: 'Alice Johnson', role: 'Developer', status: 'Active' },
          { name: 'Bob Smith', role: 'Designer', status: 'Active' },
          { name: 'Carol White', role: 'Manager', status: 'Inactive' },
        ];
      }

      // Soft delete demo initialization
      const softDeleteDemo = document.getElementById('softDeleteDemo');
      if (softDeleteDemo) {
        softDeleteDemo.data = [
          { title: 'Review pull requests', isDeleted: false },
          { title: 'Write documentation', isDeleted: false },
          { title: 'Deploy to production', isDeleted: false },
        ];
      }

      // Live bidirectional binding demo initialization
      const liveBindingDemo = document.getElementById('liveBindingDemo');
      if (liveBindingDemo) {
        liveBindingDemo.data = [
          { name: 'John Doe', email: 'john@example.com', status: 'Active' },
          { name: 'Jane Smith', email: 'jane@example.com', status: 'Away' },
        ];

        const modeSelect = document.getElementById('liveBindingMode');
        const debounceInput = document.getElementById('liveBindingDebounce');
        const applyMode = () => {
          if (modeSelect && 'value' in modeSelect) {
            liveBindingDemo.setAttribute('datachange-mode', modeSelect.value);
          }
        };
        const applyDebounce = () => {
          if (debounceInput && 'value' in debounceInput) {
            liveBindingDemo.setAttribute(
              'datachange-debounce',
              debounceInput.value
            );
          }
        };
        if (modeSelect) {
          modeSelect.addEventListener('change', applyMode);
        }
        if (debounceInput) {
          debounceInput.addEventListener('input', applyDebounce);
        }
        applyMode();
        applyDebounce();

        // Log rowchanged/datachanged events
        const bindingLog = [];
        const pushBindingLog = (message) => {
          bindingLog.unshift(message);
          bindingLog.splice(10); // Keep last 10 events

          const logEl = document.getElementById('bindingEventLog');
          if (logEl) {
            logEl.textContent = bindingLog.join('\n\n---\n\n');
          }
        };

        liveBindingDemo.addEventListener('rowchanged', (e) => {
          const detail = e.detail ?? {};
          const timestamp = new Date().toLocaleTimeString();
          const row = detail.row ?? {};
          const summary = row && typeof row === 'object'
            ? `${row.name ?? ''} <${row.email ?? ''}> [${row.status ?? ''}]`
            : String(row);

          pushBindingLog(
            `[${timestamp}] rowchanged (row ${detail.index}): ${summary}`
          );
        });
        liveBindingDemo.addEventListener('datachanged', (e) => {
          const data = e.detail?.data ?? [];
          const timestamp = new Date().toLocaleTimeString();
          const summary = data.map((item, idx) =>
            `Row ${idx}: ${item.name} <${item.email}> [${item.status}]`
          ).join('\n');

          pushBindingLog(`[${timestamp}] datachanged:\n${summary}`);
        });
      }

      // Demo Helper: Output display
      function showOutput(elementId, message) {
        document.getElementById(elementId).textContent = message;
      }

      // Event log
      const eventLog = [];
      document.addEventListener('datachanged', (e) => {
        const data = e.detail?.data ?? [];
        eventLog.unshift(
          `[${new Date().toLocaleTimeString()}] datachanged (${data.length} items)`
        );
        eventLog.splice(20);
        showOutput('eventOutput', eventLog.join('\n'));
      });
      document.addEventListener('rowchanged', (e) => {
        const detail = e.detail ?? {};
        eventLog.unshift(
          `[${new Date().toLocaleTimeString()}] rowchanged (row ${detail.index})`
        );
        eventLog.splice(20);
        showOutput('eventOutput', eventLog.join('\n'));
      });

      // Demo 1: Set Basic Data
      window.setBasicData = function () {
        const element = document.querySelector('ck-editable-array');
        const data = [
          { id: 1, name: 'Item 1', active: true },
          { id: 2, name: 'Item 2', active: false },
          { id: 3, name: 'Item 3', active: true },
        ];
        element.data = data;
        document.getElementById('dataStatus').textContent = `Array with ${data.length} items set`;
        showOutput('output', 'Data set successfully!\n\n' + JSON.stringify(data, null, 2));
      };

      // Demo 2: Set Complex Data
      window.setComplexData = function () {
        const element = document.querySelector('ck-editable-array');
        const data = [
          {
            id: 1,
            name: 'Project A',
            metadata: {
              created: '2024-01-15',
              owner: 'Alice',
              tags: ['web', 'frontend'],
            },
          },
          {
            id: 2,
            name: 'Project B',
            metadata: {
              created: '2024-02-20',
              owner: 'Bob',
              tags: ['backend', 'database'],
            },
          },
        ];
        element.data = data;
        document.getElementById('dataStatus').textContent = `Complex nested data with ${data.length} items set`;
        showOutput('output', 'Complex data set successfully!\n\n' + JSON.stringify(data, null, 2));
      };

      // Demo 3: Display Current Data
      window.displayData = function () {
        const element = document.querySelector('ck-editable-array');
        const data = element.data;
        showOutput(
          'output',
          `Current data (${data.length} items):\n\n` + JSON.stringify(data, null, 2)
        );
      };

      // Demo 4: Clear Data
      window.clearData = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = [];
        document.getElementById('dataStatus').textContent = 'Data cleared';
        showOutput('output', 'Data cleared!\n\nelement.data is now: []');
      };

      // Demo 5: Normalization Tests
      window.normalizeNull = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = null;
        showOutput('normalizeOutput', `Set data = null\nResult: ${JSON.stringify(element.data)}`);
      };

      window.normalizeUndefined = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = undefined;
        showOutput('normalizeOutput', `Set data = undefined\nResult: ${JSON.stringify(element.data)}`);
      };

      window.normalizeString = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = 'string';
        showOutput('normalizeOutput', `Set data = "string"\nResult: ${JSON.stringify(element.data)}`);
      };

      window.normalizeNumber = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = 123;
        showOutput('normalizeOutput', `Set data = 123\nResult: ${JSON.stringify(element.data)}`);
      };

      window.normalizeObject = function () {
        const element = document.querySelector('ck-editable-array');
        element.data = { obj: 1 };
        showOutput('normalizeOutput', `Set data = {}\nResult: ${JSON.stringify(element.data)}`);
      };

      // Demo 6: Set Cloning Test
      window.testSetCloning = function () {
        const element = document.querySelector('ck-editable-array');
        const original = [{ id: 1, name: 'Original', nested: { value: 'test' } }];

        element.data = original;
        const storedName = element.data[0].name;
        const storedNested = element.data[0].nested.value;

        // Modify original
        original[0].name = 'Modified';
        original[0].nested.value = 'changed';

        const stillOriginal = element.data[0].name === storedName;
        const nestedStillSame = element.data[0].nested.value === storedNested;

        showOutput(
          'setCloningOutput',
          `1. Set data with: { name: 'Original' }\n` +
            `2. Modify original: { name: 'Modified' }\n` +
            `3. Check component data:\n\n` +
            `   Component name: "${element.data[0].name}" (stored: "${storedName}")\n` +
            `   Nested value: "${element.data[0].nested.value}" (stored: "${storedNested}")\n\n` +
            `   ‚úì Set cloning works: ${stillOriginal && nestedStillSame}`
        );
      };

      // Demo 7: Get Cloning Test
      window.testGetCloning = function () {
        const element = document.querySelector('ck-editable-array');
        const data = [{ id: 1, name: 'Original', nested: { value: 'test' } }];

        element.data = data;
        const retrieved1 = element.data;
        const storedName = element.data[0].name;

        // Modify retrieved
        retrieved1[0].name = 'Modified';

        const retrieved2 = element.data;
        const stillOriginal = retrieved2[0].name === storedName;

        showOutput(
          'getCloningOutput',
          `1. Set data with: { name: 'Original' }\n` +
            `2. Get data and modify: { name: 'Modified' }\n` +
            `3. Get data again:\n\n` +
            `   Component name: "${retrieved2[0].name}" (original: "${storedName}")\n\n` +
            `   ‚úì Get cloning works: ${stillOriginal}`
        );
      };

      // Initialize demo
      console.log('CkEditableArray Demo Loaded');
    </script>
  </body>
</html>
